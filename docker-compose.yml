version: '3.8'

services:
  # Frontend UI (Arayüz)
  ui:
    build:
      context: .
      dockerfile: Dockerfile
      target: ui
      args:
        - VITE_SERVER_URL=${VITE_SERVER_URL}
        - VITE_HOSTNAME=autoserver.setrox.com.tr
    container_name: automaker-ui
    restart: unless-stopped
    ports:
      - '3007:80'
    depends_on:
      - server

  # Backend Server (Sunucu)
  server:
    build:
      context: .
      dockerfile: Dockerfile
      target: server
      args:
        # Dockerfile varsayılanı olan 1001 ID'sini kullanıyoruz (Garanti olsun)
        - UID=1001
        - GID=1001
    container_name: automaker-server
    restart: unless-stopped
    ports:
      - '3008:3008'
    environment:
      - VITE_SERVER_URL=${VITE_SERVER_URL}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - GH_TOKEN=${GH_TOKEN}
      - ALLOWED_ROOT_DIRECTORY=/projects
      - DATA_DIR=/data
      - HOME=/home/automaker
      - CORS_ORIGIN=${CORS_ORIGIN:-http://localhost:3007}
      - IS_CONTAINERIZED=true
    volumes:
      # --- KALICI VERİ DEPOLARI (VOLUMES) ---
      
      # 1. Global Ayarlar (Settings, Modeller burada tutulur)
      - automaker-data:/data
      
      # 2. Proje Dosyaları
      - automaker-projects:/projects
      
      # 3. OpenCode Giriş Bilgileri (Burası silinirse giriş düşer)
      - automaker-opencode-data:/home/automaker/.local/share/opencode
      - automaker-opencode-config:/home/automaker/.config/opencode
      
      # 4. Diğer Araçların Giriş Bilgileri
      - automaker-claude-config:/home/automaker/.claude
      - automaker-cursor-config:/home/automaker/.cursor
      - automaker-gh-config:/home/automaker/.config/gh

# Volume Tanımları
volumes:
  automaker-data:
  automaker-projects:
  automaker-opencode-data:
  automaker-opencode-config:
  automaker-claude-config:
  automaker-cursor-config:
  automaker-gh-config:
